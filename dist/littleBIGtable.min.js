function littleBIGtable(e){return{settings:{url:null,key_prefix:"lBt",limit:10,multisort:!1,args:{limit:"limit",offset:"offset",search:"search",sort:"sort"},messages:{loading:"Loading...",failed:"Loading failed",summary:"rows"},headers:{"Content-Type":"application/json","X-Requested-With":"littleBIGtable"},formatters:{},icons:"../dist/icons.svg"},meta:{loading:!1,status:null},params:{limit:10,offset:0,search:null,total:0},rows:[],sort:{},init:function(){this.params.limit=localStorage.getItem(this.settings.key_prefix+".limit"),(this.params.limit<10||this.params.limit>100)&&(this.params.limit=this.settings.limit);for(i in e)this.settings.hasOwnProperty(i)&&(this.settings[i]=e[i]);this.fetch()},fetch:function(){if(!this.settings.url){this.setStatus("Missing endpoint url, ensure you specify it in settings.");return}this.meta.loading=!0,this.setStatus(this.settings.messages.loading),fetch(this.settings.url+this.getUrlParams(),{headers:this.settings.headers}).then(t=>t.json()).then(t=>{this.rows=[],this.params.total=t.total;for(i in t.data)this.addRow(t.data[i])}).then(()=>{this.meta.loading=!1,this.setStatus(this.getSummary(this.settings.messages.summary))}).catch(t=>{console.error("Network fetch failed: ",t),this.setStatus(this.settings.messages.failed)})},addRow:function(t){let s={};for(i in t)typeof this.settings.formatters[i]=="function"?(fn=this.settings.formatters[i],s[i]=fn(t[i],t)):s[i]=t[i];for(i in this.settings.formatters)s.hasOwnProperty(i)||(fn=this.settings.formatters[i],s[i]=fn(t[i],t));this.rows.push(s)},getUrlParams:function(){let t="?"+this.settings.args.limit+"="+this.params.limit+"&"+this.settings.args.offset+"="+this.params.offset;this.params.search&&(t+="&"+this.settings.args.search+"="+this.params.search);let s=null;for(i in this.sort)s=i+":"+this.sort[i];return s&&(t+="&"+this.settings.args.sort+"="+s),t},getCurrentPage:function(){return this.params.offset==0?1:parseInt(parseInt(this.params.offset)/parseInt(this.params.limit)+1)},getTotalPages:function(){return parseInt(Math.ceil(parseInt(this.params.total)/parseInt(this.params.limit)))},getTotalRows:function(){return parseInt(this.params.total)},getFirstPageOffset:function(){return 0},getPrevPageOffset:function(){let t=parseInt(parseInt(this.getCurrentPage()-2)*parseInt(this.params.limit));return t<0?0:t},getNextPageOffset:function(){return parseInt(parseInt(this.getCurrentPage())*parseInt(this.params.limit))},getLastPageOffset:function(){let t=parseInt(parseInt(this.getTotalPages()-1)*parseInt(this.params.limit));return t<0?0:t},getOffsetForPage:function(){if(this.params.total<this.params.limit)return 0;for(i=0;i<parseInt(this.params.total);i+=parseInt(this.params.limit))if(i>=this.getPrevPageOffset()&&i<=this.getNextPageOffset())return parseInt(i)+parseInt(this.params.limit);return this.getLastPageOffset()},getFirstDisplayedRow:function(){return this.params.offset+1},getLastDisplayedRow:function(){let t=parseInt(this.params.offset)+parseInt(this.params.limit);return t>this.params.total&&(t=this.params.total),t},getSummary:function(t="rows",s="results"){return this.rows.length?t.toLowerCase()=="pages"?"Showing page <strong>"+this.getCurrentPage()+"</strong> of <strong>"+this.getTotalPages()+"</strong>":"Showing <strong>"+this.getFirstDisplayedRow()+"</strong> to <strong>"+this.getLastDisplayedRow()+"</strong> of <strong>"+this.getTotalRows()+"</strong> "+s:"No results"},getSortIcon:function(t){let s="none";return this.sort[t]!==void 0&&(s=this.sort[t]),'<svg class="icon"><use xlink:href="'+this.settings.icons+"#sort-"+s+'"></use></svg>'},setLimit:function(){(this.params.limit<10||this.params.limit>100)&&(this.params.limit=10),this.params.offset=this.getOffsetForPage(),localStorage.setItem(this.settings.key_prefix+".limit",this.params.limit),this.fetch()},setStatus:function(t){this.meta.status=t},toggleSortColumn:function(t){this.sort[t]==null?this.sort[t]="asc":this.sort[t]=="asc"?this.sort[t]="dsc":this.sort[t]=="dsc"&&delete this.sort[t]},goFirstPage:function(){this.params.offset=this.getFirstPageOffset(),this.fetch()},goLastPage:function(){this.params.offset=this.getLastPageOffset(),this.fetch()},goNextPage:function(){this.params.offset=this.getNextPageOffset(),this.fetch()},goPrevPage:function(){this.params.offset=this.getPrevPageOffset(),this.fetch()},goToPage:function(){},doSearch:function(){this.params.offset=0,this.fetch()},doSort:function(t){if(this.settings.multisort==!1){let s=this.sort[t];this.sort={},this.sort[t]=s}this.toggleSortColumn(t),this.fetch()},debug:function(){return`Params:
`+JSON.stringify(this.params)+`
Sort:
`+JSON.stringify(this.sort)+`
Meta:
`+JSON.stringify(this.meta)+`
Settings:
`+JSON.stringify(this.settings)}}}
